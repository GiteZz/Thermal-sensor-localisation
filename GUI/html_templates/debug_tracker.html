{% extends "main.html" %}

{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/debug_tracker.css')}}">
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<meta charset="UTF-8">
<script>
    $(document).ready(function(){
        var current_objects = {};  //dict: <key:(x,y)>
        var colors={}; //color per object in a dict
        var socket = io.connect('http://'+ document.domain+':'+location.port);
        var img = document.getElementById("img");
        var legend = document.getElementById("legend");

        var dots = [];
        var legend_items = [];

        socket.on('connect', function(){
            console.log('Im Connected');
           });

        socket.on('tracker_update', function(data){
            console.log("update received");
            console.log(data);

            while (img.firstChild) {
                img.removeChild(img.firstChild);
            }
            while(legend.firstChild){
                legend.removeChild(legend.firstChild);
            }
            dots = [];
            legend_items = [];

            for(person_id in data){
                person_loc = data[person_id];
                color = intToRGB(person_id);

                var dot = document.createElement("div");
                dot.id = person_id + "_dot";
                dot.className = "dot";
                dot.style.top = String(parseInt(person_loc[0])-10) + "px";
                dot.style.left = String(parseInt(person_loc[1])-10) + "px";
                dot.style.backgroundColor = "#" + color;
                img.appendChild(dot);
                dots.push(dot);

                var txt = document.createElement("div");
                txt.className = "p";
                txt.style.color = "#" + color;
                txt.innerHTML = ("<strong>ID:" + person_id + "<\strong>");
                legend.appendChild(txt);
                legend_items.push(txt);
            }
        });

    });

    function intToRGB(i) {
    var hex = (((i*30)<<2)&0xFF).toString(16) +
            (((i*15417))&0xFF).toString(16) +
            (((i*127)>>8)&0xFF).toString(16) +
            ((i*19)&0xFF).toString(16);
    // Sometimes the string returned will be too short so we 
    // add zeros to pad it out, which later get removed if
    // the length is greater than six.
    hex += '000000';
    return hex.substring(0, 6);
}
</script>
<h1>Tracker testing</h1>
<div class="main_wrapper">
    <div class="debug_img" id="img">
        <img src="../static/Img/layout.png" alt="">
    </div>
    <div class="legend" id="legend">
        <h3>Objects</h3>
    </div>
</div>
{% endblock %}